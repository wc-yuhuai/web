<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>DreamBook - 个性化图书管理系统</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        
        body {
            background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
            color: #333;
            line-height: 1.6;
            min-height: 100vh;
            padding: 20px;
        }
        
        .container {
            max-width: 1400px;
            margin: 0 auto;
        }
        
        header {
            text-align: center;
            margin-bottom: 30px;
            padding: 20px;
            background: white;
            border-radius: 10px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.08);
        }
        
        h1 {
            color: #2c3e50;
            margin-bottom: 10px;
            font-size: 2.5rem;
        }
        
        .subtitle {
            color: #7f8c8d;
            font-size: 1.1rem;
            max-width: 700px;
            margin: 0 auto;
        }
        
        .app-container {
            display: flex;
            flex-wrap: wrap;
            gap: 20px;
            margin-bottom: 30px;
        }
        
        .book-info-section, .chapter-section, .content-section {
            background: white;
            border-radius: 10px;
            padding: 25px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.08);
        }
        
        .book-info-section, .chapter-section {
            flex: 1;
            min-width: 300px;
        }
        
        .content-section {
            flex: 2;
            min-width: 600px;
        }
        
        .section-title {
            display: flex;
            align-items: center;
            color: #2c3e50;
            margin-bottom: 20px;
            padding-bottom: 10px;
            border-bottom: 2px solid #eee;
        }
        
        .section-title i {
            margin-right: 10px;
            color: #3498db;
        }
        
        .controls {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            margin-bottom: 20px;
        }
        
        .btn {
            padding: 10px 15px;
            background: #3498db;
            color: white;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 5px;
            transition: all 0.3s;
        }
        
        .btn:hover {
            background: #2980b9;
            transform: translateY(-2px);
        }
        
        .btn-danger {
            background: #e74c3c;
        }
        
        .btn-danger:hover {
            background: #c0392b;
        }
        
        .btn-success {
            background: #2ecc71;
        }
        
        .btn-success:hover {
            background: #27ae60;
        }
        
        .btn-warning {
            background: #f39c12;
        }
        
        .btn-warning:hover {
            background: #d35400;
        }
        
        .form-group {
            margin-bottom: 15px;
        }
        
        label {
            display: block;
            margin-bottom: 5px;
            font-weight: 600;
            color: #2c3e50;
        }
        
        input, textarea, select {
            width: 100%;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 5px;
            font-size: 16px;
        }
        
        textarea {
            min-height: 150px;
            resize: vertical;
        }
        
        .book-cover {
            width: 100%;
            max-width: 200px;
            height: 280px;
            object-fit: cover;
            border-radius: 5px;
            box-shadow: 0 4px 8px rgba(0,0,0,0.1);
            margin: 0 auto 15px;
            display: block;
        }
        
        .chapters-container {
            border: 1px solid #eee;
            border-radius: 5px;
            padding: 15px;
            min-height: 300px;
            max-height: 500px;
            overflow-y: auto;
            background: #f9f9f9;
        }
        
        .chapter-list {
            list-style: none;
        }
        
        .chapter-item {
            padding: 12px 15px;
            margin-bottom: 8px;
            background: white;
            border-radius: 5px;
            border-left: 4px solid #3498db;
            display: flex;
            justify-content: space-between;
            align-items: center;
            cursor: pointer;
            transition: all 0.3s;
            box-shadow: 0 2px 5px rgba(0,0,0,0.05);
        }
        
        .chapter-item:hover {
            box-shadow: 0 4px 8px rgba(0,0,0,0.1);
            transform: translateY(-2px);
        }
        
        .chapter-item.active {
            border-left: 4px solid #2ecc71;
            background: #f0fff4;
        }
        
        .item-content {
            flex: 1;
            display: flex;
            align-items: center;
        }
        
        .item-number {
            display: inline-block;
            width: 24px;
            height: 24px;
            background: #3498db;
            color: white;
            border-radius: 50%;
            text-align: center;
            line-height: 24px;
            margin-right: 10px;
            font-size: 12px;
        }
        
        .item-actions {
            display: flex;
            gap: 8px;
        }
        
        .item-actions button {
            background: none;
            border: none;
            color: #7f8c8d;
            cursor: pointer;
            transition: color 0.3s;
        }
        
        .item-actions button:hover {
            color: #3498db;
        }
        
        .content-container {
            padding: 20px;
            border: 1px solid #eee;
            border-radius: 5px;
            background: white;
            min-height: 500px;
            max-height: 600px;
            overflow-y: auto;
        }
        
        .content-header {
            margin-bottom: 20px;
            padding-bottom: 10px;
            border-bottom: 1px solid #eee;
        }
        
        .content-title {
            font-size: 1.5rem;
            color: #2c3e50;
            margin-bottom: 5px;
        }
        
        .content-subtitle {
            color: #7f8c8d;
            font-size: 0.9rem;
        }
        
        .empty-message {
            text-align: center;
            color: #7f8c8d;
            font-style: italic;
            padding: 30px;
        }
        
        .dragging {
            opacity: 0.5;
        }
        
        .status-bar {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-top: 15px;
            padding: 10px 15px;
            background: #f8f9fa;
            border-radius: 5px;
            font-size: 0.9rem;
        }
        
        .save-indicator {
            color: #27ae60;
            font-weight: bold;
        }
        
        .save-indicator.saving {
            color: #f39c12;
        }
        
        .save-indicator.error {
            color: #e74c3c;
        }
        
        @media (max-width: 1200px) {
            .content-section {
                min-width: 100%;
            }
            
            .app-container {
                flex-direction: column;
            }
        }
        
        @media (max-width: 768px) {
            .book-info-section, .chapter-section {
                min-width: 100%;
            }
        }
        
        .book-card {
            background: white;
            border-radius: 10px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.08);
            padding: 20px;
            margin-bottom: 15px;
            cursor: pointer;
            transition: all 0.3s;
        }
        
        .book-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 8px 25px rgba(0,0,0,0.12);
        }
        
        .book-card.active {
            border: 2px solid #3498db;
        }
        
        .book-card-header {
            display: flex;
            align-items: center;
            margin-bottom: 10px;
        }
        
        .book-card-cover {
            width: 60px;
            height: 80px;
            object-fit: cover;
            border-radius: 5px;
            margin-right: 15px;
        }
        
        .book-card-info {
            flex: 1;
        }
        
        .book-card-title {
            font-weight: bold;
            color: #2c3e50;
            margin-bottom: 5px;
        }
        
        .book-card-author {
            color: #7f8c8d;
            font-size: 0.9rem;
        }
        
        .book-card-stats {
            display: flex;
            justify-content: space-between;
            color: #95a5a6;
            font-size: 0.8rem;
            margin-top: 10px;
        }
        
        .modal {
            display: none;
            position: fixed;
            z-index: 1000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0,0,0,0.5);
        }
        
        .modal-content {
            background-color: white;
            margin: 5% auto;
            padding: 20px;
            border-radius: 10px;
            width: 80%;
            max-width: 600px;
            max-height: 80vh;
            overflow-y: auto;
        }
        
        .close {
            color: #aaa;
            float: right;
            font-size: 28px;
            font-weight: bold;
            cursor: pointer;
        }
        
        .close:hover {
            color: #000;
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1><i class="fas fa-book"></i> DreamLib </h1>
            <p class="subtitle">创建、编辑和管理您的个性化图书。自定义书名、封面、章节和内容，并保存至云端数据库。</p>
        </header>
        
        <div class="app-container">
            <!-- 左侧：图书信息 -->
            <section class="book-info-section">
                <h2 class="section-title"><i class="fas fa-book-open"></i> 图书信息</h2>
                
                <div class="controls">
                    <button class="btn" id="newBookBtn">
                        <i class="fas fa-plus"></i> 新建图书
                    </button>
                    <button class="btn btn-success" id="saveBookBtn">
                        <i class="fas fa-save"></i> 保存图书
                    </button>
                    <button class="btn btn-warning" id="loadBookBtn">
                        <i class="fas fa-folder-open"></i> 我的书库
                    </button>
                </div>
                
                <div class="form-group">
                    <label for="bookTitle">书名</label>
                    <input type="text" id="bookTitle" placeholder="请输入图书标题">
                </div>
                
                <div class="form-group">
                    <label for="bookAuthor">作者</label>
                    <input type="text" id="bookAuthor" placeholder="请输入作者姓名">
                </div>
                
                <div class="form-group">
                    <label for="bookDescription">简介</label>
                    <textarea id="bookDescription" placeholder="请输入图书简介"></textarea>
                </div>
                
                <div class="form-group">
                    <label for="bookCover">封面图片URL</label>
                    <input type="text" id="bookCover" placeholder="请输入封面图片链接">
                </div>
                
                <div class="form-group">
                    <label>当前封面</label>
                    <img id="coverPreview" class="book-cover" src="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='200' height='280' viewBox='0 0 200 280'%3E%3Crect fill='%23e0e0e0' width='200' height='280'/%3E%3Ctext x='50%25' y='50%25' dominant-baseline='middle' text-anchor='middle' fill='%23999' font-size='14' font-family='Arial'%3E图书封面%3C/text%3E%3C/svg%3E" alt="封面预览">
                </div>
                
                <div class="status-bar">
                    <div>状态: <span id="statusText" class="save-indicator">就绪</span></div>
                    <div id="lastSaved">上次保存: 从未</div>
                </div>
            </section>
            
            <!-- 中间：章节管理 -->
            <section class="chapter-section">
                <h2 class="section-title"><i class="fas fa-list"></i> 章节管理</h2>
                
                <div class="controls">
                    <button class="btn" id="addChapterBtn">
                        <i class="fas fa-plus"></i> 添加章节
                    </button>
                    <button class="btn btn-danger" id="removeChapterBtn">
                        <i class="fas fa-trash"></i> 删除章节
                    </button>
                </div>
                
                <div class="chapters-container">
                    <ul class="chapter-list" id="chapterList">
                        <!-- 章节列表将通过JS动态添加 -->
                        <li class="empty-message" id="emptyChapterMessage">暂无章节，请添加新章节</li>
                    </ul>
                </div>
                
                <div class="form-group">
                    <label for="chapterTitle">章节标题</label>
                    <input type="text" id="chapterTitle" placeholder="请输入章节标题">
                </div>
                
                <div class="form-group">
                    <label for="chapterNumber">章节编号</label>
                    <input type="number" id="chapterNumber" placeholder="请输入章节编号" min="1">
                </div>
                
                <div class="controls">
                    <button class="btn btn-success" id="updateChapterBtn">
                        <i class="fas fa-sync"></i> 更新章节
                    </button>
                </div>
            </section>
            
            <!-- 右侧：内容编辑 -->
            <section class="content-section">
                <h2 class="section-title"><i class="fas fa-edit"></i> 内容编辑</h2>
                
                <div class="content-header">
                    <div class="content-title" id="currentChapterTitle">请选择章节</div>
                    <div class="content-subtitle" id="currentChapterSubtitle">点击左侧章节开始编辑内容</div>
                </div>
                
                <div class="content-container">
                    <textarea id="chapterContent" placeholder="在此输入章节内容..."></textarea>
                </div>
                
                <div class="controls" style="margin-top: 15px;">
                    <button class="btn btn-success" id="saveContentBtn">
                        <i class="fas fa-save"></i> 保存内容
                    </button>
                    <button class="btn" id="previewContentBtn">
                        <i class="fas fa-eye"></i> 预览内容
                    </button>
                </div>
            </section>
        </div>
        
        <!-- 书库模态框 -->
        <div id="libraryModal" class="modal">
            <div class="modal-content">
                <span class="close">&times;</span>
                <h2><i class="fas fa-bookmark"></i> 我的书库</h2>
                <div id="libraryBooks">
                    <!-- 书库内容将通过JS动态添加 -->
                    <div class="empty-message">您还没有创建任何图书</div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // 数据模型
        let currentBook = {
            id: null,
            title: '',
            author: '',
            description: '',
            cover: '',
            chapters: [],
            lastModified: null
        };
        
        let currentChapterId = null;
        
        // DOM元素
        const bookTitleInput = document.getElementById('bookTitle');
        const bookAuthorInput = document.getElementById('bookAuthor');
        const bookDescriptionInput = document.getElementById('bookDescription');
        const bookCoverInput = document.getElementById('bookCover');
        const coverPreview = document.getElementById('coverPreview');
        const chapterList = document.getElementById('chapterList');
        const emptyChapterMessage = document.getElementById('emptyChapterMessage');
        const chapterTitleInput = document.getElementById('chapterTitle');
        const chapterNumberInput = document.getElementById('chapterNumber');
        const chapterContentTextarea = document.getElementById('chapterContent');
        const currentChapterTitle = document.getElementById('currentChapterTitle');
        const currentChapterSubtitle = document.getElementById('currentChapterSubtitle');
        const statusText = document.getElementById('statusText');
        const lastSaved = document.getElementById('lastSaved');
        const libraryModal = document.getElementById('libraryModal');
        const closeModal = document.querySelector('.close');
        
        // 初始化
        document.addEventListener('DOMContentLoaded', function() {
            // 绑定事件
            document.getElementById('newBookBtn').addEventListener('click', createNewBook);
            document.getElementById('saveBookBtn').addEventListener('click', saveBook);
            document.getElementById('loadBookBtn').addEventListener('click', showLibrary);
            document.getElementById('addChapterBtn').addEventListener('click', addChapter);
            document.getElementById('removeChapterBtn').addEventListener('click', removeChapter);
            document.getElementById('updateChapterBtn').addEventListener('click', updateChapter);
            document.getElementById('saveContentBtn').addEventListener('click', saveChapterContent);
            document.getElementById('previewContentBtn').addEventListener('click', previewContent);
            
            // 监听封面URL变化
            bookCoverInput.addEventListener('input', function() {
                coverPreview.src = this.value || 'data:image/svg+xml,%3Csvg xmlns=\'http://www.w3.org/2000/svg\' width=\'200\' height=\'280\' viewBox=\'0 0 200 280\'%3E%3Crect fill=\'%23e0e0e0\' width=\'200\' height=\'280\'/%3E%3Ctext x=\'50%25\' y=\'50%25\' dominant-baseline=\'middle\' text-anchor=\'middle\' fill=\'%23999\' font-size=\'14\' font-family=\'Arial\'%3E图书封面%3C/text%3E%3C/svg%3E';
            });
            
            // 模态框关闭事件
            closeModal.addEventListener('click', function() {
                libraryModal.style.display = 'none';
            });
            
            window.addEventListener('click', function(event) {
                if (event.target === libraryModal) {
                    libraryModal.style.display = 'none';
                }
            });
            
            // 初始化示例数据
            initializeSampleData();
        });
        
        // 初始化示例数据
        function initializeSampleData() {
            currentBook = {
                id: 'sample-1',
                title: '梦幻之旅',
                author: '梦源作者',
                description: '这是一本关于梦想与探索的奇幻小说，讲述了主人公在神秘世界中的冒险故事。',
                cover: 'https://images.unsplash.com/photo-1544947950-fa07a98d237f?ixlib=rb-4.0.3&auto=format&fit=crop&w=400&q=80',
                chapters: [
                    { id: 'ch-1', number: 1, title: '第一章 梦的开始', content: '很久很久以前，在一个遥远的地方...' },
                    { id: 'ch-2', number: 2, title: '第二章 神秘森林', content: '主人公踏入了传说中的神秘森林...' },
                    { id: 'ch-3', number: 3, title: '第三章 遇见精灵', content: '在森林深处，主人公遇见了一群友善的精灵...' }
                ],
                lastModified: new Date()
            };
            
            renderBookInfo();
            renderChapterList();
            updateStatusBar('就绪', true);
        }
        
        // 创建新图书
        function createNewBook() {
            if (confirm('确定要创建新图书吗？当前内容将会丢失。')) {
                currentBook = {
                    id: 'book-' + Date.now(),
                    title: '',
                    author: '',
                    description: '',
                    cover: '',
                    chapters: [],
                    lastModified: new Date()
                };
                
                renderBookInfo();
                renderChapterList();
                updateStatusBar('新建图书', true);
            }
        }
        
        // 渲染图书信息
        function renderBookInfo() {
            bookTitleInput.value = currentBook.title;
            bookAuthorInput.value = currentBook.author;
            bookDescriptionInput.value = currentBook.description;
            bookCoverInput.value = currentBook.cover;
            coverPreview.src = currentBook.cover || 'data:image/svg+xml,%3Csvg xmlns=\'http://www.w3.org/2000/svg\' width=\'200\' height=\'280\' viewBox=\'0 0 200 280\'%3E%3Crect fill=\'%23e0e0e0\' width=\'200\' height=\'280\'/%3E%3Ctext x=\'50%25\' y=\'50%25\' dominant-baseline=\'middle\' text-anchor=\'middle\' fill=\'%23999\' font-size=\'14\' font-family=\'Arial\'%3E图书封面%3C/text%3E%3C/svg%3E';
        }
        
        // 渲染章节列表
        function renderChapterList() {
            chapterList.innerHTML = '';
            
            if (currentBook.chapters.length === 0) {
                chapterList.appendChild(emptyChapterMessage);
                emptyChapterMessage.style.display = 'block';
                return;
            }
            
            emptyChapterMessage.style.display = 'none';
            
            // 按章节编号排序
            const sortedChapters = [...currentBook.chapters].sort((a, b) => a.number - b.number);
            
            sortedChapters.forEach(chapter => {
                const li = document.createElement('li');
                li.className = 'chapter-item';
                li.dataset.id = chapter.id;
                
                if (currentChapterId === chapter.id) {
                    li.classList.add('active');
                }
                
                li.innerHTML = `
                    <div class="item-content">
                        <span class="item-number">${chapter.number}</span>
                        <span class="item-title">${chapter.title}</span>
                    </div>
                    <div class="item-actions">
                        <button class="edit-btn" title="编辑"><i class="fas fa-edit"></i></button>
                    </div>
                `;
                
                // 绑定点击事件
                li.addEventListener('click', () => selectChapter(chapter.id));
                
                // 绑定编辑按钮事件
                li.querySelector('.edit-btn').addEventListener('click', (e) => {
                    e.stopPropagation();
                    editChapter(chapter.id);
                });
                
                chapterList.appendChild(li);
            });
        }
        
        // 选择章节
        function selectChapter(id) {
            currentChapterId = id;
            const chapter = currentBook.chapters.find(c => c.id === id);
            
            if (chapter) {
                chapterTitleInput.value = chapter.title;
                chapterNumberInput.value = chapter.number;
                chapterContentTextarea.value = chapter.content || '';
                
                currentChapterTitle.textContent = `第${chapter.number}章: ${chapter.title}`;
                currentChapterSubtitle.textContent = `字数: ${(chapter.content || '').length} 字`;
                
                renderChapterList(); // 更新活动状态
            }
        }
        
        // 编辑章节（在输入框中填入章节信息）
        function editChapter(id) {
            const chapter = currentBook.chapters.find(c => c.id === id);
            
            if (chapter) {
                chapterTitleInput.value = chapter.title;
                chapterNumberInput.value = chapter.number;
                currentChapterId = id;
                
                renderChapterList(); // 更新活动状态
            }
        }
        
        // 添加章节
        function addChapter() {
            const title = chapterTitleInput.value.trim();
            const number = parseInt(chapterNumberInput.value);
            
            if (!title) {
                alert('请输入章节标题');
                return;
            }
            
            if (!number || number <= 0) {
                alert('请输入有效的章节编号');
                return;
            }
            
            // 检查编号是否已存在
            const existingChapter = currentBook.chapters.find(c => c.number === number);
            if (existingChapter) {
                alert(`章节编号 ${number} 已存在`);
                return;
            }
            
            const newChapter = {
                id: 'ch-' + Date.now(),
                number: number,
                title: title,
                content: ''
            };
            
            currentBook.chapters.push(newChapter);
            currentBook.lastModified = new Date();
            
            renderChapterList();
            updateStatusBar('章节已添加', true);
        }
        
        // 更新章节
        function updateChapter() {
            if (!currentChapterId) {
                alert('请选择要更新的章节');
                return;
            }
            
            const title = chapterTitleInput.value.trim();
            const number = parseInt(chapterNumberInput.value);
            
            if (!title) {
                alert('请输入章节标题');
                return;
            }
            
            if (!number || number <= 0) {
                alert('请输入有效的章节编号');
                return;
            }
            
            // 检查编号是否与其他章节冲突（除了当前章节）
            const existingChapter = currentBook.chapters.find(c => 
                c.id !== currentChapterId && c.number === number
            );
            
            if (existingChapter) {
                alert(`章节编号 ${number} 已存在`);
                return;
            }
            
            const chapterIndex = currentBook.chapters.findIndex(c => c.id === currentChapterId);
            if (chapterIndex !== -1) {
                currentBook.chapters[chapterIndex].title = title;
                currentBook.chapters[chapterIndex].number = number;
                currentBook.lastModified = new Date();
                
                renderChapterList();
                updateStatusBar('章节已更新', true);
            }
        }
        
        // 删除章节
        function removeChapter() {
            if (!currentChapterId) {
                alert('请选择要删除的章节');
                return;
            }
            
            const chapter = currentBook.chapters.find(c => c.id === currentChapterId);
            if (!chapter) return;
            
            if (confirm(`确定要删除章节 "${chapter.title}" 吗？`)) {
                currentBook.chapters = currentBook.chapters.filter(c => c.id !== currentChapterId);
                currentChapterId = null;
                currentBook.lastModified = new Date();
                
                chapterTitleInput.value = '';
                chapterNumberInput.value = '';
                chapterContentTextarea.value = '';
                currentChapterTitle.textContent = '请选择章节';
                currentChapterSubtitle.textContent = '点击左侧章节开始编辑内容';
                
                renderChapterList();
                updateStatusBar('章节已删除', true);
            }
        }
        
        // 保存章节内容
        function saveChapterContent() {
            if (!currentChapterId) {
                alert('请选择要保存的章节');
                return;
            }
            
            const content = chapterContentTextarea.value;
            const chapterIndex = currentBook.chapters.findIndex(c => c.id === currentChapterId);
            
            if (chapterIndex !== -1) {
                currentBook.chapters[chapterIndex].content = content;
                currentBook.lastModified = new Date();
                
                currentChapterSubtitle.textContent = `字数: ${content.length} 字`;
                
                updateStatusBar('内容已保存', true);
            }
        }
        
        // 预览内容
        function previewContent() {
            if (!currentChapterId) {
                alert('请选择要预览的章节');
                return;
            }
            
            const content = chapterContentTextarea.value;
            const chapter = currentBook.chapters.find(c => c.id === currentChapterId);
            
            if (!chapter) return;
            
            // 在新窗口中预览
            const previewWindow = window.open('', '_blank');
            previewWindow.document.write(`
                <!DOCTYPE html>
                <html>
                <head>
                    <title>${chapter.title} - 预览</title>
                    <style>
                        body { 
                            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; 
                            max-width: 800px; 
                            margin: 0 auto; 
                            padding: 20px; 
                            line-height: 1.6;
                        }
                        h1 { color: #2c3e50; }
                        .chapter-meta { 
                            color: #7f8c8d; 
                            font-style: italic; 
                            margin-bottom: 20px; 
                            border-bottom: 1px solid #eee;
                            padding-bottom: 10px;
                        }
                    </style>
                </head>
                <body>
                    <h1>${chapter.title}</h1>
                    <div class="chapter-meta">第${chapter.number}章 | 字数: ${content.length}</div>
                    <div>${content.replace(/\n/g, '<br>')}</div>
                </body>
                </html>
            `);
        }
        
        // 保存图书到模拟数据库
        function saveBook() {
            if (!currentBook.title) {
                alert('请输入图书标题');
                return;
            }
            
            if (!currentBook.author) {
                alert('请输入作者姓名');
                return;
            }
            
            updateStatusBar('保存中...', false);
            
            // 模拟数据库保存
            setTimeout(() => {
                currentBook.title = bookTitleInput.value;
                currentBook.author = bookAuthorInput.value;
                currentBook.description = bookDescriptionInput.value;
                currentBook.cover = bookCoverInput.value;
                currentBook.lastModified = new Date();
                
                // 模拟保存到本地存储
                const books = JSON.parse(localStorage.getItem('dream_books') || '[]');
                const existingIndex = books.findIndex(b => b.id === currentBook.id);
                
                if (existingIndex !== -1) {
                    books[existingIndex] = currentBook;
                } else {
                    books.push(currentBook);
                }
                
                localStorage.setItem('dream_books', JSON.stringify(books));
                
                updateStatusBar('图书已保存', true);
                lastSaved.textContent = `上次保存: ${formatDate(currentBook.lastModified)}`;
            }, 1000);
        }
        
        // 显示书库
        function showLibrary() {
            const books = JSON.parse(localStorage.getItem('dream_books') || '[]');
            const libraryBooks = document.getElementById('libraryBooks');
            
            if (books.length === 0) {
                libraryBooks.innerHTML = '<div class="empty-message">您还没有创建任何图书</div>';
            } else {
                libraryBooks.innerHTML = '';
                
                books.forEach(book => {
                    const bookCard = document.createElement('div');
                    bookCard.className = 'book-card';
                    bookCard.innerHTML = `
                        <div class="book-card-header">
                            <img src="${book.cover || 'data:image/svg+xml,%3Csvg xmlns=\'http://www.w3.org/2000/svg\' width=\'60\' height=\'80\' viewBox=\'0 0 60 80\'%3E%3Crect fill=\'%23e0e0e0\' width=\'60\' height=\'80\'/%3E%3Ctext x=\'50%25\' y=\'50%25\' dominant-baseline=\'middle\' text-anchor=\'middle\' fill=\'%23999\' font-size=\'10\' font-family=\'Arial\'%3E封面%3C/text%3E%3C/svg%3E'}" class="book-card-cover" alt="封面">
                            <div class="book-card-info">
                                <div class="book-card-title">${book.title}</div>
                                <div class="book-card-author">作者: ${book.author}</div>
                            </div>
                        </div>
                        <div class="book-card-stats">
                            <span>章节: ${book.chapters.length}</span>
                            <span>更新: ${formatDate(book.lastModified)}</span>
                        </div>
                    `;
                    
                    bookCard.addEventListener('click', () => {
                        currentBook = book;
                        renderBookInfo();
                        renderChapterList();
                        updateStatusBar('图书已加载', true);
                        lastSaved.textContent = `上次保存: ${formatDate(currentBook.lastModified)}`;
                        
                        libraryModal.style.display = 'none';
                    });
                    
                    libraryBooks.appendChild(bookCard);
                });
            }
            
            libraryModal.style.display = 'block';
        }
        
        // 更新状态栏
        function updateStatusBar(message, success = true) {
            statusText.textContent = message;
            statusText.className = 'save-indicator';
            
            if (!success) {
                statusText.classList.add('saving');
            } else if (!message.includes('错误')) {
                setTimeout(() => {
                    statusText.textContent = '就绪';
                }, 2000);
            }
        }
        
        // 格式化日期
        function formatDate(date) {
            return new Date(date).toLocaleString('zh-CN');
        }
    </script>
</body>
</html>